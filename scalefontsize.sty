% Package   : scalefontsize -- Scale the font size by a factor
% Copyright : 2025 (c) Oliver Beery <beeryoliver@gmail.com>
% CTAN      : <ADD CTAN LINK HERE>
% Repository: https://github.com/beeryoliver/scalefontsize
% License   : The LaTeX Project Public License 1.3c

% Loading the package

\NeedsTeXFormat{LaTeX2e}[2023-11-01]
\ProvidesExplPackage{scalefontsize}{2025-12-27}{0.0.0}
  {Scale the font size by a factor.}

\msg_new:nnn { scalefontsize } { l3kernel }
  {
    The~ scalefontsize~ package~ could~ not~ load. \\
    This~ package~ requires~
    L3~ programming~ layer~ version~ 2023-11-01~ or~ newer.
  }
\IfExplAtLeastTF { 2023-11-01 } { }
  { \msg_critical:nn { scalefontsize } { l3kernel } }

% Variable

\fp_new:N \l__scalefontsize_tmp_fp

% Document command

\NewDocumentCommand \scalefontsize { m }
  {
    \mode_if_math:TF
      { \msg_error:nn { scalefontsize } { math-mode-invalid } }
      { \__scalefontsize_scale_font_size:n {#1} }
  }
\cs_new_protected:Npn \__scalefontsize_scale_font_size:n #1
  {
    \fp_set:Nn \l__scalefontsize_tmp_fp {#1}
    \exp_args:Ne \__scalefontsize_scale_font_size_aux:n
      {
        \fp_to_dim:n { \l__scalefontsize_tmp_fp * \dim_to_fp:n { \f@size pt } }
      }
  }
\cs_new_protected:Npn \__scalefontsize_scale_font_size_aux:n #1
  {
    \dim_compare:nTF { \c_zero_dim < #1 < 2048pt }
      {
        \fontsize {#1}
          {
            \fp_to_dim:n
              { \l__scalefontsize_tmp_fp * \dim_to_fp:n { \f@baselineskip } }
          }
        \selectfont
      }
      { \msg_error:nnn { scalefontsize } { font-size-invalid } {#1} }
  }

% Purifying text

\text_declare_purify_equivalent:Nn \scalefontsize { \use_none:n }

% Messages

\msg_new:nnn { scalefontsize } { math-mode-invalid }
  {
    '\iow_char:N \\ scalefontsize'~ invalid~ in~ math~ mode~
    \msg_line_context:.
  }
\msg_new:nnn { scalefontsize } { font-size-invalid }
  {
    Invalid~ font~ size~ '#1'~ \msg_line_context:. \\
    The~ font~ size~ must~ be~ a~ positive~ length~ and~ less~ than~ 2048pt.
  }
